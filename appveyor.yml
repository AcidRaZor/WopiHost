skip_commits:
  files:
  - '*.md'

nuget:
  account_feed: true
  
init:
  - git config --global core.autocrlf true
  
install:
 - cmd: nuget sources add -Name api.nuget.org -Source https://api.nuget.org/v3/index.json

build:
  verbosity: normal

before_build:
 - ps: dotnet restore

test: off

test_script:
 - ps: >-

    iwr https://chocolatey.org/install.ps1 -UseBasicParsing | iex
    
    choco install opencover.portable -y

    ForEach ($folder in (Get-ChildItem -Path .\ -Directory -Filter *.Tests)) { 

    dotnet test $folder.FullName -xml ($folder.FullName + "\xunit-results.xml") 
    
    $targetArgs = '-targetargs: test ' + $ENV:APPVEYOR_BUILD_FOLDER + $folder.FullName + ' -c ' + $ENV:CONFIGURATION

    $filter = '-filter:-[*.Tests]*'

    $openCoverConsole '-target:C:\Program Files\dotnet\dotnet.exe' $targetArgs '-register:user' $filter '-oldStyle' '-mergeoutput' '-output:coverage.xml'
    
    }

after_test:
  - .\packages\OpenCover.4.5.3522\OpenCover.Console.exe -register:user -target:"C:\Program Files (x86)\Microsoft Visual Studio 12.0\Common7\IDE\MSTest.exe" -targetargs:"/noresults /noisolation /testcontainer:"".\MyProject Unit Tests\bin\Debug\MyProject.UnitTests.dll" -filter:"+[MyProject]*  -[MyProject]MyProject.Properties.*" -excludebyattribute:*.ExcludeFromCodeCoverage* -hideskipped:All -output:.\MyProject_coverage.xml
  - "SET PATH=C:\\Python34;C:\\Python34\\Scripts;%PATH%"
  - pip install codecov
  - codecov -f "MyProject_coverage.xml"